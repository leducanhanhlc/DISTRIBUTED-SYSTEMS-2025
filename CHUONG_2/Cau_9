1. Äiá»u gÃ¬ xáº£y ra khi cháº¡y chÆ°Æ¡ng trÃ¬nh?

Khi cháº¡y nhiá»u láº§n, chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ:

Bá»‹ treo (hang): khÃ´ng in ra káº¿t quáº£ a, b ná»¯a, vÃ¬ cÃ¡c luá»“ng chá» nhau vÃ´ háº¡n.

Hoáº·c náº¿u may máº¯n (scheduler sáº¯p xáº¿p thuáº­n lá»£i), nÃ³ váº«n cháº¡y Ä‘Æ°á»£c vÃ  in káº¿t quáº£.

ğŸ‘‰ Hiá»‡n tÆ°á»£ng nÃ y chÃ­nh lÃ  deadlock (báº¿ táº¯c).

2. Giáº£i thÃ­ch mÃ£ nguá»“n

Ta cÃ³ 2 biáº¿n chia sáº» a, b vÃ  2 lock lock_a, lock_b.
CÃ³ 2 luá»“ng cháº¡y song song:

Luá»“ng 1 (fun_1):

pthread_mutex_lock(&lock_a); // lock a trÆ°á»›c
pthread_mutex_lock(&lock_b); // rá»“i lock b
// critical section
pthread_mutex_unlock(&lock_a);
pthread_mutex_unlock(&lock_b);


Luá»“ng 2 (fun_2):

pthread_mutex_lock(&lock_b); // lock b trÆ°á»›c
pthread_mutex_lock(&lock_a); // rá»“i lock a
// critical section
pthread_mutex_unlock(&lock_b);
pthread_mutex_unlock(&lock_a);

TÃ¬nh huá»‘ng gÃ¢y deadlock:

Thread 1 chiáº¿m Ä‘Æ°á»£c lock_a.

Thread 2 chiáº¿m Ä‘Æ°á»£c lock_b.

Thread 1 cá»‘ gáº¯ng láº¥y lock_b, nhÆ°ng lock_b Ä‘ang bá»‹ giá»¯ bá»Ÿi Thread 2.

Thread 2 cá»‘ gáº¯ng láº¥y lock_a, nhÆ°ng lock_a Ä‘ang bá»‹ giá»¯ bá»Ÿi Thread 1.

ğŸ‘‰ Cáº£ 2 luá»“ng Ä‘á»u Ä‘á»©ng chá» vÃ´ háº¡n â†’ deadlock.

3. Káº¿t luáº­n

Khi cháº¡y chÆ°Æ¡ng trÃ¬nh, Ä‘Ã´i khi ta sáº½ tháº¥y nÃ³ bá»‹ treo, khÃ´ng káº¿t thÃºc â†’ Ä‘Ã¢y chÃ­nh lÃ  deadlock.

NguyÃªn nhÃ¢n: hai luá»“ng giá»¯ lock theo thá»© tá»± khÃ¡c nhau (lock_a â†’ lock_b vÃ  lock_b â†’ lock_a).

ÄÃ¢y lÃ  vÃ­ dá»¥ kinh Ä‘iá»ƒn cá»§a deadlock do circular wait (má»™t trong bá»‘n Ä‘iá»u kiá»‡n dáº«n tá»›i deadlock: Mutual exclusion, Hold & wait, No preemption, Circular wait).

4. CÃ¡ch trÃ¡nh deadlock

LuÃ´n Ä‘áº£m báº£o táº¥t cáº£ luá»“ng lock theo cÃ¹ng má»™t thá»© tá»± (vÃ­ dá»¥ luÃ´n lock a trÆ°á»›c rá»“i má»›i lock b).

Hoáº·c dÃ¹ng cÃ¡c ká»¹ thuáº­t nÃ¢ng cao nhÆ° trylock + timeout, deadlock detection, hoáº·c lock hierarchy.
